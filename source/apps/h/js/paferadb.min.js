function DB(){this.intransaction=false;this.commands=[]}DB.prototype.Begin=function(){this.intransaction=true;return this};DB.prototype.Commit=function(){if(!this.commands.length){return}var a=_.promise();P.API("db/run",{commands:this.commands},function(b){a.fire(b.error?false:true,b)},{timeout:300,handleerror:0});this.intransaction=false;this.commands=[];return a};DB.prototype.Load=function(b,d,e,a,c){a=a||"*";c=c||[];this.commands.push({result:b,command:"load",model:d,ids:e,fields:a,methods:c});if(!this.intransaction){return this.Commit()}return this};DB.prototype.LoadMany=function(b,c,d,a){a=a||"*";this.commands.push({result:b,command:"loadmany",model:c,ids:d,fields:a});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Find=function(a,c,d,b){var f=null;var e=0;var b=b||{};start=b.start||0;limit=b.limit||100;orderby=b.orderby||"";fields=b.fields||"*";methods=b.methods||[];this.commands.push({result:a,command:"find",model:c,cond:d,start:start,limit:limit,orderby:orderby,fields:fields});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Update=function(a,b,c,d){this.commands.push({result:a,command:"update",model:b,ids:c,data:d});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Save=function(a,b,c){this.commands.push({result:a,command:"save",model:b,data:c});if(!this.intransaction){return this.Commit()}return this};DB.prototype.SaveMany=function(a,b,c){this.commands.push({result:a,command:"savemany",model:b,data:c});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Delete=function(a,c,b){this.commands.push({command:"delete",model:a,ids:c,cond:b});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Link=function(g,d,e,c,b,a,f){b=b||0;a=a||0;f=f||"";this.commands.push({command:"link",model1:g,id1:d,model2:e,id2:c,linktype:b,num:a,comment:f});if(!this.intransaction){return this.Commit()}return this};DB.prototype.LinkArray=function(g,d,e,c,b,a,f){b=b||0;a=a||0;f=f||"";this.commands.push({command:"linkarray",model1:g,id1:d,model2:e,id2:c,linktype:b,num:a,comment:f});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Unlink=function(e,c,d,b,a){this.commands.push({command:"unlink",model1:e,id1:c,model2:d,id2:b,linktype:a});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Linked=function(a,g,d,f,c,e,b){c=c||0;e=e||"";b=b||[];this.commands.push({result:a,command:"linked",model1:g,id1:d,model2:f,linktype:c,orderby:e,methods:b});if(!this.intransaction){return this.Commit()}return this};DB.prototype.UnlinkMany=function(d,b,c,a){a=a||0;this.commands.push({command:"unlinkmany",model1:d,id1:b,model2:c,linktype:a});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Query=function(a,b){this.commands.push({result:a,command:"query",query:b});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Eval=function(a,b){this.commands.push({result:a,command:"eval",code:b});if(!this.intransaction){return this.Commit()}return this};DB.prototype.Fields=function(a,b){this.commands.push({result:a,command:"fields",model:b});if(!this.intransaction){return this.Commit()}return this};DB.prototype.ListTypes=function(a){this.commands.push({result:a,command:"listtypes"});if(!this.intransaction){return this.Commit()}return this};DB.prototype.SaveTranslation=function(a,c,d,b){this.commands.push({result:a,command:"savetranslation",model:c,ids:d,translations:b});if(!this.intransaction){return this.Commit()}return this};var _db=new DB();