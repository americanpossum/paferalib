function ListUsers(b,c,a){b=b||"";c=c||0;a=a||100;P.LoadingAPI(".UserResults","users/list",{start:c,limit:a,orderby:b,listgroups:(groups==0?1:0),filter:$$(".Filter").value},function(r,n){if(groups==0){groups=r.groups}if(!r.items.length){n.fill(T[49]);return}var p=["<div class=Cards4>"];for(var o=0,h=r.items.length;o<h;o++){var t=r.items[o];var e=[];var s=t.groups;for(var k=0,f=s.length;k<f;k++){var q=groups[s[k]];if(q){e.push(q.translated?q.translated:q.name)}}p.addtext(['<div class="Card whiteb HoverHighlight" data-userid="'+t.id+'" onclick="EditUser(\''+t.id+"')\">",'<div class="CardActions Size150" onclick="CardMenu(this)"><a class="Color3">&gt;</a></div>','<img src="'+t.headshot+'" class=CardIcon>',"<div class=Title>"+t.username+"</div>","<div class=Description>"+t.phonenumber+" - "+t.place+"</div>","<div class=Groups>"+e.join(", ")+"</div>","</div>"])}p.push("</div>");p.addtext(P.PageBar(r.count,c,a,b,r.items.length));n.ht(p.join("\n"));P.OnResize();setTimeout(P.OnResize,200)})}function ListGroups(b,c,a){b=b||"";c=c||0;a=a||100;P.LoadingAPI(".UserResults","users/listgroups",{start:c,limit:a,orderby:b,filter:$$(".Filter").value},function(n,k){var f=['<table class="Width100 Styled">'];groups=n.items;var g=P.SortArray(groups,1,"name");for(var j=0,e=g.length;j<e;j++){var h=g[j][0];var m=groups[h];f.addtext(["<tr>","<td class=HoverHighlight onclick=\"ViewGroup('"+h+"', '"+m.name+"')\">"+m.name+"</td>","<td class=Color1 onclick=\"EditGroup('"+h+"')\">"+T[56]+"</td>","<td class=Color2 onclick=\"DeleteGroupPopup('"+h+"', '"+m.name+"')\">"+T[22]+"</td>","</tr>"])}f.push("</table>");f.addtext(P.PageBar(n.count,c,a,b,g.length));k.ht(f.join("\n"))})}function ViewGroup(b,a){currentgroup={id:b,name:a};ListMembers()}function ListMembers(b,c,a){b=b||"";c=c||0;a=a||100;P.LoadingAPI(".UserResults","users/list",{start:c,limit:a,orderby:b},function(k,h){if(!k.items.length){h.fill(T[49]);return}var f=["<div class=Members>"];for(var g=0,e=k.items.length;g<e;g++){var j=k.items[g];f.addtext(['<div class=ToggleButton data-name="users" data-userid="'+j.id+'" data-toggled="'+(j.groups.indexOf(currentgroup.id)>-1?"on":"unset")+'">','<img class="Square400 FloatLeft" src="'+j.headshot+'">',EncodeEntities(j.phonenumber)+"<br>",EncodeEntities(j.place)+"<br>",EncodeEntities(j.username),"</div>"])}f.push("</div>");f.addtext(P.PageBar(k.count,c,a,b,k.items.length));P.HTML(h,f);P.MakeToggleButtons(".ToggleButton");P.SameWidth(".Members .ToggleButton",14);P.SameMaxHeight(".Members .ToggleButton");setTimeout(function(){P.SameWidth(".Members .ToggleButton",14)},300);P.OnClick(".Members .ToggleButton",function(l,i){var d=i.get("%userid");var m=i.get("%toggled");if(d){P.DialogAPI("users/setgroup",{userid:d,groupid:currentgroup.id,ismember:(m=="unset"?1:0)},function(){})}})})}function CardMenu(c){if(c.type){return}var b=$(c);if(!b.is(".Card")){b=b.up(".Card")}if(!b.length){return}var a=b.get("%userid");var d=$(".Title",b).text();P.Popup(HTML(['<div class="Raised">',"<div class=ContextMenu>","<a onclick=\"P.CloseThisPopup(this); EditUser('"+a+"')\">"+T[56]+"</a>","<a class=DeleteButton>"+T[22]+"</a>","</div>","</div>"].join("\n")),{"$left":P.mousex+"px","$top":P.mousey+"px","$width":"12em",closeonmouseout:1});P.OnClick(".DeleteButton",function(){DeleteUserPopup(a,d)});return 0}function DeleteUserPopup(a,b){P.ConfirmDeletePopup(b,function(){DeleteUser(a)})}function DeleteGroupPopup(b,a){P.ConfirmDeletePopup(a,function(){DeleteGroup(b)})}function EditUser(a){$(".FullScreen").set("+dblueg").ht('<div class="EditDiv"></div>').show();if(!a){EditUserForm();return}P.LoadingAPI(".EditDiv","users/view",{userid:a},function(c,b){EditUserForm(c)},{timeout:999})}function EditGroup(a){P.Popup(HTML('<div class="whiteb Raised Rounded Pad50 EditDiv"></div>'));if(!a){EditGroupForm();return}P.LoadingAPI(".EditDiv","users/viewgroup",{groupid:a},function(c,b){EditGroupForm(c)})}function EditGroupForm(a){P.EditPopup([["translated_translated","text",a?a.item.translated:"",T_ADMIN[6]],["groupname","text",a?a.item.name:"",T_ADMIN[5]],["groupid","hidden",a?a.item.id:""]],function(c,b){P.LoadingAPI(".EditDivResults","users/savegroup",b,function(f,e){P.CloseThisPopup(".groupname");ListGroups()})},{formdiv:"EditDiv",cancelfunc:function(){P.CloseThisPopup(".groupname")}})}function EditUserForm(h){P.EditPopup([h?["headshot","custom","",T[58],"Headshot"]:0,["username_translated","text",h?h.item.username:"",T[16]],["phonenumber","text",h?h.item.phonenumber:"",T[36]],["place","text",h?h.item.place:"",T[43]],["password","password","",T[17]],["email","text",h?h.item.email:"",T[44]],h?["groups","custom","",T[20],"Groups"]:0,["userid","hidden",h?h.item.id:""]],function(i,d){P.LoadingAPI(".EditDivResults","users/save",d,function(l,k){$(".FullScreen").hide();ListUsers()})},{formdiv:"EditDiv",cancelfunc:function(){$(".FullScreen").hide()}});if(h){P.HTML(".Headshot",['<a class="Button Color1" onclick="P.UploadFilePopup(\'a/h/upload/headshot/'+h.item.id+"')\">",'<img src="'+(h.item.headshot?h.item.headshot:P.IconURL("user"))+'">',"</a>"]);if(groups){var b=[];var c=P.SortArray(groups,1,"name");for(var f=0,a=c.length;f<a;f++){var e=c[f][0];var g=groups[e];var j=(h&&h.item.groups.indexOf(e)>-1)?1:0;b.push('<div class=ToggleButton data-name="groups.'+e+'" data-toggled='+(j?"on":"unset")+">"+EncodeEntities(g.name)+"</div>")}P.HTML(".EditDiv .Groups",b);P.MakeToggleButtons(".ToggleButton")}}}function DeleteUser(a){P.ClosePopup();P.DialogAPI("users/delete",{userid:a},function(){});$(".Card").find(function(b){if($(b).get("%userid")==a){$(b).remove();return 0}})}function DeleteGroup(a){P.ClosePopup();P.DialogAPI("users/deletegroup",{groupid:a},function(){});$("tr").find(function(b){if($(b).get("%groupid")==userid){$(b).remove();return 0}})}_loader.OnFinished(function(){$(".CardAction").hide();P.AddHandler("resize",function(){P.SameWidth(".Card",20);P.SameWidth(".Members .ToggleButton",14)});ListUsers()});