forumuri="";forumthreadid=0;forumbounty=0;function DisplayForum(b,c,a){b=b||"";c=c||0;a=a||100;P.LoadingAPI(".Forum","forums/list",{orderby:b,start:c,limit:a,uri:forumuri,threadid:forumthreadid},function(k,h){if(!k.items.length){h.fill(T[49]);return}var f=[];for(var g=0,e=k.items.length;g<e;g++){var j=k.items[g];f.addtext(['<div class="Card whiteb ForumPost" data-postid="'+j.id+'" data-threadid="'+j.threadid+'" data-bounty="'+j.bounty+'">',"<div class=Title>"+j.title+(parseInt(j.bounty)?" ("+j.bounty+")":"")+"</div>","<div class=SentTime>"+DisplayTime(j.senttime)+"</div>","<div class=Message>"+j.message+"</div>","<div class=ButtonBar>",'<a class="Color1 ReplyButton">'+T_FORUM[2]+"</a>","</div>","</div>"])}f.addtext(P.PageBar(k.count,c,a,b,k.items.length,"ListImages"));P.HTML(h,f);P.SameWidth(".ForumPost",20);P.OnClick(".ReplyButton",Reply)})}function Reply(d,a){if(a){a=a.up(".ForumPost")}var c=a?a.get("%postid"):"";var b=a?a.get("%threadid"):"";var f=a?$(".Title",a).text():"";if(f){if(f[0]==">"){f=">"+f}else{f="> "+f}}P.EditPopup([["title","text",f,T_LEARN[59]],["message","multitext","",T_LEARN[60]],["uploadfile","custom","","","UploadFile"],(forumbounty&&!a)?["bounty","float","",T_LEARN[90]]:""],function(g,e){var h=parseFloat(e.description);if(!e.title||!e.message){P.ErrorPopup(T[48]);return}var i=[];$(".UploadedFile").each(function(j){var k=$(j).get("%fileid");if(k){i.push(k)}});e.fileids=i;e.uri=forumuri;e.parentid=c;e.threadid=b;P.LoadingAPI(".EditPopupResults","h/forums/save",e,function(k,j){j.ht('<div class="greeng Pad50">'+T_LEARN[89]+"</div>")})});$(".UploadFile").ht('<a class="Button UploadButton Color1" onclick="UploadFile()">'+T[29]+"</a><br><table class=UploadedFilesTable></table>")}function UploadFile(){P.UploadFilePopup(P.APIURL("upload/file","h"),{accept:"*; capture=camera",maxsize:1024*1024*5,title:T_LEARN[15],onfinished:function(b,f,a){var c=JSON.parse(f.response);uploadedfiles[c.id]=a;DisplayUploadedFiles();P.CloseThisPopup(".uploadtitle")}})}function DisplayUploadedFiles(){var b=[];var c=P.SortArray(uploadedfiles);for(var e=0,a=c.length;e<a;e++){var d=c[e][0];var f=uploadedfiles[d];b.addtext(["<tr>",'<td class=UploadedFile data-fileid="'+d+'">'+f+"</td>",'<td class="Color1" onclick="DeleteUpload(\''+d+"', this)\">"+T[22]+"</td>","</tr>"])}P.HTML(".UploadedFilesTable",b)}function DeleteUpload(b,a){P.DeleteUpload(b,function(c){$(a).up("tr").remove()})};