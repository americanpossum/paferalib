LBUTTON=0;RBUTTON=1;MBUTTON=2;P={Init:function(){this.lang=1;this.userid=0;this.wallpaper="blue";this.texttheme="dark";this.media={};this.mediatoload=[];this.onmedialoaded=[];this.currentmediaid=0;this.events={};this.messageboxids=[];this.features=[];this.possumbot="possum";this.quickfuncs=[];this.istouch=0;this.mousex=0;this.mousey=0;this.currenty=0;this.holdpos=0;this.ignoreup=0;this.lastclicktime=0;this.emsize=0;this.firstview=1;this.screensize="small";this.currenturl="";this.viewportwidth=0;this.viewportheight=0;this.dontrestorecontent=[];this.timeoffset=new Date().getTimezoneOffset();this.ischrome=/\bChrome\b/.test(navigator.userAgent);this.isfirefox=/\bFirefox\b/.test(navigator.userAgent);this.issafari=/\bSafari\b/.test(navigator.userAgent);this.isedge=/\bEdge\b/.test(navigator.userAgent);this.useadvanced=this.ischrome||this.isfirefox||this.issafari||this.isedge;this.preloads={};this.screenorientation=window.innerWidth>window.innerHeight?"landscape":"portrait";this.currentpermissions="";this.inphoneapp=(typeof JSBridge!="undefined");this.onuploadfinished=0;this.layerstack=[]},URL:function(a,b){b=b||P.currentapp;return P.baseurl+b+"/"+a},APIURL:function(a,b){b=b||P.currentapp;return P.baseurl+"a/"+b+"/"+a},DataURL:function(a,b){b=b||P.currentapp;return P.baseurl+"d/"+b+"/"+a},ImageURL:function(a,b){b=b||P.currentapp;return P.baseurl+"i/"+b+"/"+a},SoundURL:function(a,b){b=b||P.currentapp;return P.baseurl+"s/"+b+"/"+a},CSSURL:function(a,b){b=b||P.currentapp;return P.baseurl+"c/"+b+"/"+a+".css"},JSURL:function(a,b){b=b||P.currentapp;return P.baseurl+"j/"+b+"/"+a+".js"},Target:function(b){b=b||window.event;var a=b.target||b.srcElement;return $(a)},Selected:function(a){var b=$$(a);return b.options[b.selectedIndex]},Debug:function(a){$$(".DebugMessages").innerHTML+=a+"\n"},CancelBubble:function(a){a=a||window.event;if(a.stopPropagation){a.preventDefault();a.stopPropagation()}else{a.cancelBubble=true}},HTML:function(a,b){var c=$$(a);if(c){c.innerHTML=b.join("\n")}},CodeDir:function(e){var b=[];for(var c=0,a=e.length;c<a;c+=3){b.push(e.substr(c,3))}return b.join("/")},DoneTyping:function(a,e,f){f=f||1000;var b=$(a);var c=b[0];b.on("|change |keydown |paste |input",function(g){if(c.typingtimeoutid){clearTimeout(c.typingtimeoutid)}c.typingtimeoutid=setTimeout(function(){c.typingtimeoutid=0;e(b)},f)});b.on("|blur",function(g){if(c.typingtimeoutid){clearTimeout(c.typingtimeoutid);c.typingtimeoutid=0;e(b)}})},OnClick:function(a,f,c,b,e){var g=interact(a);if(c){g.on("tap",function(h){if(c&&(h.button==f||h.button==undefined)){if((!P.holdpos||(Math.abs(h.screenX-P.holdpos.x)>32||Math.abs(h.screenY-P.holdpos.y)>32))){c(h)}P.holdpos=0}})}if(b){g.on("doubletap",function(h){if(b&&(h.button==f||h.button==undefined)){b(h)}})}if(e){g.on("hold",function(h){if(e&&(h.button==f||h.button==undefined)){e(h);P.holdpos={x:h.screenX,y:h.screenY}}})}},AddHandler:function(b,a){if(!this.events[b]){this.events[b]=[]}this.events[b].push(a)},ClearHandlers:function(a){this.events[a]=[]},Loading:function(a){var b=$(a);if(b.length){b.ht(["<div class=Center>",'<img style="height: 1.3em;" src="'+this.baseurl+'i/h/loading.gif">',"<div class=Cleared></div>","</div>"].join("\n"));P.ScrollTo(b)}},ScrollTo:function(a){setTimeout(function(){var e=$(a);if(e.length){var c=P.AbsoluteRect(e);var b=c.top<window.pageYOffset;if(b||c.bottom>window.pageYOffset+window.innerHeight){e[0].scrollIntoView({behavior:"smooth",block:b?"start":"end"})}}},200)},AbsoluteRect:function(c){var b=$$(c);if(!b){return 0}var a=b.getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,right:a.right+window.pageXOffset,bottom:a.bottom+window.pageYOffset,width:a.width,height:a.height}},EMSize:function(a){a=a||document.body;return Number(getComputedStyle(a,"").fontSize.match(/(\d*(\.\d*)?)px/)[1])},AutoWidth:function(){$(".AutoWidth").each(function(o,g,a){o=$(o);var l=o.up();var n=l.get("$width",true);var m=P.EMSize($$(l));var b=o.get("%autowidth",true);var e=Math.round(n/(m*b));var j=0;var c=o.get(["$marginLeft","$paddingLeft","$paddingRight","$marginRight"],true);for(var f in c){if(c[f]){j+=c[f]}}if(!e){e=1}var h=Math.floor((n/e)-j);o.set("$width",h+"px");if(o.get("%autosquare")){o.set("$height",h+"px")}})},SameWidth:function(f,b,n){var a=$(f);if(!a.length){return}var p=$(a[0]);var m=p.up();var o=m.get("$width",true);var h=P.EMSize($$(m));var e=Math.round(o/(b*h));var l=0;var c=p.get(["$marginLeft","$paddingLeft","$paddingRight","$marginRight"],true);for(var g in c){if(c[g]){l+=c[g]}}if(!e){e=1}var j=Math.floor((o/e)-l);a.set("$width",j+"px");if(n){a.set("$height",Math.floor(j*n)+"px")}return j+"px"},SameMaxWidth:function(b){var a=0;var f=$(b);if(!f.length){return}f.each(function(k,g,h){var j=parseFloat($$(k).clientWidth);if(j>a){a=j}});var c=P.EMSize($$(f[0]));var e=Math.round(((a/c)+0.00001)*100)/100;f.set("$width",e+"em")},SameMaxHeight:function(a){var f=0;var e=$(a);if(!e.length){return}e.each(function(k,h,j){var g=parseFloat($$(k).clientHeight);if(g>f){f=g}});var b=P.EMSize($$(e[0]));var c=Math.round(((f/b)+0.00001)*100)/100;e.set("$height",c+"em")},Trace:function(){StackTrace.get().then(function(a){var b=a.map(function(c){return c.toString()}).join("\n");console.log(b)})},Popup:function(h,l){var f={"$width":"16em","$color":"black","$backgroundColor":"transparent","$zIndex":1000};switch(P.screensize){case"medium":f.width="22em";break;case"large":f.width="30em";break}l=Merge(f,l);var c=l.popupclass?l.popupclass:0;if(!c){for(;;){c="Popup"+RandInt(1,999999999);if(!$("."+c).length){break}}}$("body").add(HTML('<div class="Popup '+c+'" style="position: absolute; left: 0; top: 0;"></div>'));var a=$("."+c);a.fill(h);a.set(l);var k=P.ViewPortRect();var b=a[0].getBoundingClientRect();var e=0;var j=0;if(l.parent){var g=P.AbsoluteRect(l.parent);switch(l.position){case"left":e=g.left-b.width;j=g.top;break;case"top":e=g.left;j=g.top-b.height;break;case"right":e=g.right;j=g.top;break;default:e=g.left;j=g.bottom}}else{var g={left:P.mousex,top:P.mousey,width:0,height:0};e=l["$left"]?parseInt(l["$left"]):k.width/2-b.width/2+k.left;j=l["$top"]?parseInt(l["$top"]):k.height/2-b.height/2+k.top}if(e+b.width>k.right){e=k.right-b.width-P.emsize}if(j+b.height>k.bottom){j=k.bottom-b.height}if(e<k.left){e=k.left}if(j<k.top){j=k.top}a.set({"$left":g.left+"px","$top":g.top+"px","$width":g.width+"px","$height":g.height+"px"}).show().animate({"$left":e+"px","$top":j+"px","$width":l["$width"],"$height":"auto"},300);if(l.closeonmouseout){setTimeout(function(){P.mousex=e+1;P.mousey=j+1;P.ClosePopupOnMouseOut([l.parent,"."+c])},500)}P.AddLayer(c);return"."+c},ClosePopupOnMouseOut:function(h,b){var f=0;for(var g=0,e=h.length;g<e;g++){var c=P.AbsoluteRect(h[g]);if(P.InRect(P.mousex,P.mousey,c)){f=1;break}}if(!f){var a=h[h.length-1];P.RemoveLayer(a);$(a).remove();if(b){b()}return}setTimeout(function(){P.ClosePopupOnMouseOut(h,b)},500)},CloseThisPopup:function(a){var b=$(a);if(b.is(".Popup")){P.ClosePopup(b)}else{P.ClosePopup(b.up("div.Popup"))}},MessageBox:function(e,c,b){if(!b){b={}}if(!b.popupclass){var f=RandInt(1,99999999);while(P.messageboxids.indexOf(f)!=-1){f=RandInt(1,99999999)}b.popupclass="MsgBox"+f}var a=['<div class="Pad50 whiteb Raised">'];if(!IsArray(e)){e=[e]}a.addtext(e);a.push("<div class=MessageBoxBar></div></div>");P.Popup(HTML(a.join("\n")),b);if(!c){c=[[T[1],function(){P.CloseThisPopup("."+b.popupclass+" .MessageBoxBar")}]]}P.MakeButtonBar("."+b.popupclass+" .MessageBoxBar",c)},ErrorPopup:function(b,a){P.MessageBox(['<div class="Pad100 Error">','<img src="/i/h/icons/caution.png" class="FloatLeft Padded">',"<span class=ErrorPopupMsg>"+b+"</span>","</div>","<br class=Cleared>"],[[T[1],function(){P.CloseThisPopup(".ErrorPopupMsg")}]],Merge({popupclass:"ErrorPopup"},a))},ClosePopup:function(a){a=a||".Popup";$(a).animate({"$left":"0px","$top":"0px","$width":"0px","$height":"0px"},300);setTimeout(function(){var b=$(a);if(b.length){b.remove()}},300)},EditPopup:function(z,D,g){g=g||{};var r={"$backgroundColor":"white",popupclass:"EditPopup"};var f=g.formdiv;var c=f?f+"Form":"EditPopupForm";var J=g.cancelfunc;var b=g.fullscreen;var n=g.gobuttontext;var x=g.cancelbuttontext;var p=g.extrabuttons||"";var w=f?(f+"Results"):"EditPopupResults";delete g.formdiv;delete g.cancelfunc;delete g.fullscreen;delete g.gobuttontext;delete g.cancelbuttontext;delete g.extrabuttons;g=Merge(r,g);var o=['<form class="'+c+'">'];if(P.screensize!="small"){o.push('<table class="Width100 EditPopupTable"><tbody>');if(!g["$width"]){g["$width"]="40em"}}for(var H=0,E=z.length;H<E;H++){if(!z[H]){continue}var K=z[H][0];var y=z[H][1];var C=z[H][2];var a=z[H][3];var h=z[H][4];var A=z[H][5];if(!A){A=""}if(!C){C=""}if(!h){h=""}switch(y){case"select":var u=[];if(IsArray(h)){for(var G=0,B=h.length;G<B;G++){var t=h[G];u.push("<option "+((C==t)?"selected":"")+">"+t+"</option>")}}else{for(var F in h){var t=h[F];u.push('<option value="'+t+'" '+((C==t)?"selected":"")+">"+F+"</option>")}}editfield='<select name="'+K+'" class="'+K+'" '+A+">"+u.join("\n")+"</select>";break;case"multitext":editfield='<div class=FlexInput data-name="'+K+'" class="'+K+'" data-value="'+EncodeEntities(C.toString())+'" placeholder="'+EncodeEntities(h)+'" data-attrs="'+EncodeEntities(A)+'">';break;case"int":editfield='<input type=number name="'+K+'" class="'+K+'" value="'+C+'" placeholder="'+EncodeEntities(h)+'" '+A+">";break;case"float":editfield='<input type=number step=any name="'+K+'" class="'+K+'" value="'+C+'" placeholder="'+EncodeEntities(h)+'"'+A+">";break;case"datetime-local":editfield='<input type=datetime-local name="'+K+'" class="'+K+'" value="'+GMTToLocal(C)+'" placeholder="'+EncodeEntities(h)+'"'+A+">";break;case"custom":editfield='<input type=hidden name="'+K+'" class="'+K+'" value="'+EncodeEntities(C.toString())+'"'+A+'><div class="FormRow '+h+'"></div>';break;default:editfield="<input type="+y+' name="'+K+'" class="'+K+'" value="'+EncodeEntities(C.toString())+'" placeholder="'+EncodeEntities(h)+'"'+A+">"}if(y=="hidden"){o.push(editfield)}else{if(P.screensize=="small"){o=o.concat(['<div class="'+K+'Row">',"<label>"+a+"</label>",editfield,"</div>"])}else{o=o.concat(['<tr class="'+K+'Row">',"<th class=Width8>"+a+"</th>","<td>"+editfield+"</td>","</tr>"])}}}if(P.screensize!="small"){o.push("</tbody></table><br>")}o.addtext(["<br class=Cleared>","<div class=ButtonBar>",'<a class="ConfirmButton Color3"><img class="LineHeight BusyIcon">'+(n?n:T[47])+"</a>",'<a class="Spacer Width2"></a>',f?'<a class="ResetButton Color2"><img class="LineHeight BusyIcon">'+T[39]+"</a>":"",'<a class="CancelButton Color1"><img class="LineHeight BusyIcon">'+(x?x:T[1])+"</a>",p,"</div>","</form>",'<div class="'+w+'"></div>',"<div class=Cleared></div>"]);if(f){P.HTML("."+f,o);var s="."+f+" .ResetButton";$(s).on("click",P.Busy(s,function(){$$("."+c).reset()}));if(J){var I="."+f+" .CancelButton";$(I).on("click",P.Busy(I,function(){J("."+f)}))}}else{if(b||P.screensize=="small"){$(".FullScreen").set("+dblueg").ht(o.join("\n")).show();var I=".FullScreen .CancelButton";$(I).on("click",P.Busy(I,function(){$(".FullScreen").hide();if(J){J(".FullScreen")}}));f="FullScreen"}else{f=P.Popup(HTML('<div class="whiteb Pad50 Raised">'+o.join("\n")+"</div>"),g);var I=f+" .CancelButton";$(I).on("click",P.Busy(I,function(){$(f).remove();if(J){J(f)}}))}}var q="."+c+" .ConfirmButton";$(q).on("click",P.Busy(q,function(){if(D("."+f,P.FormToArray("."+c),$("."+w))){if(f=="FullScreen"){$(".FullScreen").hide()}else{if(f.indexOf("#Popup")!=-1){P.CloseThisPopup(this)}}}}));$("."+c).on("submit",function(j){if(j.preventDefault){j.preventDefault()}});P.FlexInput();var e=$("."+c+" input");if(e.length){e[0].focus()}else{e=$("."+c+" textarea");if(e.length){e[0].focus()}}if(P.screensize!="small"){$(".EditPopupTable select").set({"$position":"relative","$top":"1em"});$(".EditPopupTable th").set({"$position":"relative","$top":"0.5em"});$(".EditPopupTable input").set({"$margin":"0px","$width":"110%"});$(".EditPopupTable .FlexInput").set({"$marginTop":"1em","$border":"0.01em solid transparent"})}},EditThis:function(c,b,a){c=$(c);if(a){a=[["newvalue"].concat(a)]}else{a=[["newvalue","multitext",e,"Change text"]]}var e=c.text();P.EditPopup(a,function(){var f=$(".newvalue").get("value");c.fill(f);if(b){b(c,f)}return true},{parent:c,popupclass:"EditThisPopup"})},FlagToToggle:function(e,b,a){var c=" data-toggled=";if(e&b){return c+"on"}if(e&a){return c+"off"}return c+"unset"},EditPermissionPopup:function(a,b){P.HTML(".FullScreenContent",['<div class="Pad50 EditPermissions">',"<h2>Editing Permissions for "+a+"("+JSON.stringify(b)+")</h2>","<div class=PermissionResults></div>","<div class=ButtonBar>",'<a class="ConfirmButton Color3" onclick="P.SavePermissions()">'+T[34]+"</a>",'<a class="AddButton Color2" onclick="P.AddPermissionPopup()">'+T[21]+"</a>",'<a class="CancelButton Color1" onclick="$(\'.FullScreen\').hide();">'+T[1]+"</a>","</div>","<div class=Cleared></div>","<div class=SavePermissionResults></div>","</div>"]);$(".FullScreen").set("+dblueg").show();P.LoadingAPI(".PermissionResults","permissions/get",{model:a,objid:b},function(e,c){e.item.model=a;e.item.ids=b;P.currentpermissions=e.item;P.DisplayPermissions()})},DisplayPermissions:function(){var g=$(".PermissionResults");if(!P.currentpermissions){g.ht("No permissions found");return}var h=P.currentpermissions;var c=['<table class="Width100 Permissions">',"<tr data-type=owner>","<th>Owner</th>",'<td colspan=7 class="greeng Owner HoverHighlight" data-objid='+h.owner+">"+h.ownername+"</td>","</tr>","<tr data-type=defaults>","<th>Defaults</th>","<td class=ToggleButton"+P.FlagToToggle(h.access,1,2)+">Create</td>","<td class=ToggleButton"+P.FlagToToggle(h.access,64,128)+">Read</td>","<td class=ToggleButton"+P.FlagToToggle(h.access,4,8)+">Write</td>","<td class=ToggleButton"+P.FlagToToggle(h.access,16,32)+">Delete</td>","<td class=ToggleButton"+P.FlagToToggle(h.access,256,512)+">Link</td>","<td class=ToggleButton"+P.FlagToToggle(h.access,4096,8192)+">View All</td>","<td></td>","</tr>","<tr data-type=header class=usersheader>","<th colspan=7>Users</th>","</tr>"];var b=h.users.length;if(!b){c.push("<tr data-type=none><td colspan=7>No users added.</td></tr>")}else{for(var f=0,b=h.users.length;f<b;f++){var e=h.users[f];var a=e.access;c.addtext(["<tr data-type=user data-objid="+e.id+">","<th>"+e.name+"</th>","<td class=ToggleButton"+P.FlagToToggle(a,1,2)+">Create</td>","<td class=ToggleButton"+P.FlagToToggle(a,64,128)+">Read</td>","<td class=ToggleButton"+P.FlagToToggle(a,4,8)+">Write</td>","<td class=ToggleButton"+P.FlagToToggle(a,16,32)+">Delete</td>","<td class=ToggleButton"+P.FlagToToggle(a,256,512)+">Link</td>","<td class=ToggleButton"+P.FlagToToggle(a,4096,8192)+">View All</td>",'<td class=Color1 onclick="P.DeletePermissions(this)">Delete</td>',"</tr>"])}}c.addtext(["<tr data-type=header class=groupsheader>","<th colspan=7>Groups</th>","</tr>"]);if(!b){c.push("<tr data-type=none><td colspan=7>No groups added.</td></tr>")}else{for(var f=0,b=h.groups.length;f<b;f++){var j=h.groups[f];var a=j.access;c.addtext(["<tr data-type=user data-objid="+j.id+">","<th>"+j.name+"</th>","<td class=ToggleButton"+P.FlagToToggle(a,1,2)+">Create</td>","<td class=ToggleButton"+P.FlagToToggle(a,64,128)+">Read</td>","<td class=ToggleButton"+P.FlagToToggle(a,4,8)+">Write</td>","<td class=ToggleButton"+P.FlagToToggle(a,16,32)+">Delete</td>","<td class=ToggleButton"+P.FlagToToggle(a,256,512)+">Link</td>","<td class=ToggleButton"+P.FlagToToggle(a,4096,8192)+">View All</td>",'<td class=Color1 onclick="P.DeletePermissions(this)">Delete</td>',"</tr>"])}}c.push("</table>");P.HTML(g,c);P.MakeToggleButtons(".EditPermissions .ToggleButton",1);P.OnClick(".Permissions .Owner",LBUTTON,P.ChangeOwnerPopup)},DeletePermissions:function(g){var h=$(g).up("tr");var m=parseInt(h.get("%objid"));var a=$("th",h,1).text();var k=P.currentpermissions;switch(h.get("%type")){case"user":for(var f=0,b=k.users.length;f<b;f++){var c=k.users[f];if((m&&c.id==m)||c.name==a){P.currentpermissions.users.splice(f,1);break}}break;case"groups":for(var f=0,b=k.groups.length;f<b;f++){var j=k.groups[f];if((m&&j.id==m)||j.name==a){P.currentpermissions.groups.splice(f,1);break}}break}P.DisplayPermissions()},ChangeOwner:function(){var a=$$(".newowner").value;$(".Permissions .Owner").set("%objid",0).fill(a);P.currentpermissions.owner=0;P.currentpermissions.ownername=a;P.ClosePopup(".ChangeOwnerPopup");return true},ChangeOwnerPopup:function(){P.EditPopup([["newowner","text","",T[53]]],P.ChangeOwner,{parent:".Permissions .Owner",cancelfunc:function(a){P.CloseThisPopup(a)},popupclass:"ChangeOwnerPopup"});P.OnEnter(".newowner",P.ChangeOwner)},AddPermissionPopup:function(a,b){P.Popup(HTML(['<div class="Pad50 whiteb AddPermission">',"<div>Type of permissions to add:</div>",'<div class="Radio AddTypeSelect">',"<input type=text value=users class=addtype>","<div data-value=users>User</div>","<div data-value=groups>Group</div>","</div>","<br class=Cleared><br>","<div>","Name or phone to add:","</div>","<div>","<input type=text class=addid>","</div>","<div class=ButtonBar>",'<a class="ConfirmButton Color3" onclick="P.AddPermission()">'+T[21]+"</a>",'<a class="Spacer Width400"></>','<a class="CancelButton Color1" onclick="P.CloseThisPopup(this);">'+T[1]+"</a>","</div>","<div class=Cleared></div>","</div>"].join("\n")),{popupclass:"AddPermissionPopup"});P.MakeRadioButtons(".AddTypeSelect");P.OnEnter(".addid",P.AddPermission)},AddPermission:function(){P.currentpermissions[$$(".addtype").value].push({id:0,name:$$(".addid").value,access:0});P.DisplayPermissions();P.ClosePopup(".AddPermissionPopup")},RowToAccess:function(b){var a=0;$("td",b,1).each(function(e,c){var f=$(e).get("%toggled");switch(f){case"on":switch(c){case 0:a|=1;break;case 1:a|=64;break;case 2:a|=4;break;case 3:a|=16;break;case 4:a|=256;break;case 5:a|=4096;break}break;case"off":switch(c){case 0:a|=2;break;case 1:a|=128;break;case 2:a|=8;break;case 3:a|=32;break;case 4:a|=512;break;case 5:a|=8192;break}break}});return a},SavePermissions:function(){var a={owner:$(".Owner").get("%objid"),ownername:$(".Owner").text(),users:[],groups:[],model:P.currentpermissions.model,objid:P.currentpermissions.ids};$(".Permissions tr").each(function(b){b=$(b);switch(b.get("%type")){case"user":a.users.push({id:b.get("%objid"),name:$("th",b,1).text(),access:P.RowToAccess(b)});break;case"group":a.groups.push({id:b.get("%objid"),name:$("th",b,1).text(),access:P.RowToAccess(b)});break;case"owner":var c=$("td",b,1);a.owner=c.get("%objid");a.ownername=c.text();break;case"defaults":a.access=P.RowToAccess(b);break}});P.LoadingAPI(".SavePermissionResults","permissions/set",a,function(){$(".FullScreen").hide()},{timeout:600})},Icon:function(a,e,c,b){c=c||"LineHeight";b=b||"3";return'<img class="'+c+'" src="'+P.IconURL(a,e)+'" style="width: '+b+"em; height: "+b+'em" />'},IconURL:function(a,b){b=b||P.currentapp;return P.baseurl+"i/"+b+"/icons.svg#"+a},SortableTDs:function(){return['<td class="Color3 Center">',P.Icon("Down","h","FlipV",1.5),"</td>",'<td class="Color4 Center">',P.Icon("Down","h","",1.5),"</td>",'<td class="Color1 Center">',P.Icon("Cancel","h","",1.5),"</td>","</tr>"]},Tooltip:function(a,c,b){b=b||1000;$(a).onOver(function(f,e){var g=$(this);if(f){g.set("%tooltiptimer",setTimeout(function(){var j=P.Popup(HTML(c(g)),{parent:g,position:"top",closeonmouseout:1});$(j).set("+Tooltip")},b))}else{var h=g.get("%tooltiptimer");if(h){clearTimeout(h);g.set("%tooltiptimer","")}}})},MakeButtonBar:function(a,j){var e=[];var f=1;var h=0;var c="";for(var g=0,b=j.length;g<b;g++){h=j[g];if(h[1]=="custom"){e.push(h[0]);continue}if(h.length>2&&h[2]){f=h[2]}c=(h.length>3)?h[3]:"";e.push('<a class="Color'+f+" Button"+g+" "+c+'"><img class="LineHeight BusyIcon">'+h[0]+"</a>");f++;if(f>6){f=1}}$(a).set("+ButtonBar").ht(e.join("\n"));for(var g=0,b=j.length;g<b;g++){var h=a+" .Button"+g;P.OnClick(h,LBUTTON,P.Busy(h,j[g][1]))}},DragMoveListener:function(b){var c=b.target,a=(parseFloat(c.getAttribute("data-x"))||0)+b.dx,e=(parseFloat(c.getAttribute("data-y"))||0)+b.dy;c.style.webkitTransform=c.style.transform="translate("+a+"px, "+e+"px)";c.setAttribute("data-x",a);c.setAttribute("data-y",e)},MakeFloatingButton:function(a,e){var c=$(a);if(!c.length){var b=P.Popup(HTML(e));c=$(b);c.hide()}setTimeout(function(){c.set("+"+a.substr(1)).set({"$zIndex":"1100","$position":"fixed","$left":"110%","$top":"80%","$cursor":"nwse-resize"}).show().animate({"$left":"80%","$top":"80%","$width":"auto"},300)},500);interact(a).draggable({inertia:true,autoScroll:true,onmove:P.DragMoveListener,restrict:{restriction:"parent",endOnly:true,elementRect:{top:0,left:0,bottom:1,right:1}}});return a},Busy:function(a,b){return function(c,g){var e=$(a+" .BusyIcon");var f=e.get("@src");e.set("@src",P.ImageURL("busy.svg","h"));b(c,g);setTimeout(function(){e.set("@src",f)},500)}},MakeRange:function(b,h,e,a,g,j,c){g=g?g:e;j=j||"";var f=$(b);P.HTML(f,["<div class=ButtonBar>",j?"<span class=RangeTitle>"+j+"</span>":"",'<meter class="Range '+h+'" min='+e+" max="+a+" value="+g+"></meter>","<span class=RangeDisplay>"+g+"</span>","</div>"]);P.OnClick(b+" .Range",LBUTTON,function(q){var n=$(b+" .Range");var o=parseInt(n.get("@min"));var k=parseInt(n.get("@max"));var p=n[0].value;var l=P.AbsoluteRect(n);var m=Math.round(((P.mousex-l.left)/l.width)*(k-o))+o;if(p==m){return}n[0].value=m;$(b+" .RangeDisplay").fill(m);c(n,m)})},MoveUp:function(c,a,b){c=$(c);if(a){c=c.up(a)}if(!c.length){return}var e=$(c.trav("previousSibling")[0]);c.addAfter(e.clone());e.remove();if(b){b(c)}},MoveDown:function(e,a,b){e=$(e);if(a){e=e.up(a)}if(!e.length){return}var c=e.next();e.addBefore(c.clone());c.remove();if(b){b(e)}},MakeSortableTable:function(a){$(a).on("click",function(g){var f=P.Target(g);if(f[0].tagName!="TD"){f=f.up("td")}var c=f.up("tr");var b=$("img",f);var h=b.get("@src");if(!h){return}if(h.indexOf("Cancel")!=-1){c.remove()}else{if(b.is(".FlipV")){P.MoveUp(c)}else{P.MoveDown(c)}}})},ConfirmDeletePopup:function(b,a){P.Popup(HTML(['<div class="DeletePopup yellowb Pad50">',"<p>",T[57]+b+"?","</p>","<div class=DeleteButtonBar></div>","<div class=Cleared></div>","<div class=ConfirmDeleteResults></div>","<div class=Cleared></div>","</div>"].join("\n")),{popupclass:"ConfirmDeletePopup"});P.MakeButtonBar(".DeleteButtonBar",[[T[34],a][T[1],function(c,e){P.CloseThisPopup(e)}]])},ViewPortRect:function(){var b=window,j=document,h=j.documentElement,f=j.getElementsByTagName("body")[0];var c=b.innerWidth;var a=b.innerHeight;return{left:b.pageXOffset,top:b.pageYOffset,right:b.pageXOffset+c,bottom:b.pageYOffset+a,width:c,height:a}},OnResize:function(){if(!P.emsize){return}var e=P.ViewPortRect();P.viewportwidth=e.width;P.viewportheight=e.height;P.numems=e.width/P.emsize;if(P.numems<25){P.screensize="small"}else{if(P.numems<50){P.screensize="medium"}else{P.screensize="large"}}$("#ScreenSizeStylesheet").set("@href",P.baseurl+"c/h/"+P.screensize+".css");if(P.wallpaper){$("body").set("$backgroundImage","url('/i/h/wallpapers/"+P.wallpaper+"-"+P.screensize+".jpg')")}if(P.texttheme){$("#TextThemeStylesheet").set("@href","/c/h/themes/"+P.texttheme+".css")}if(!IsEmpty(P.events.resize)){var b=P.events.resize;for(var c=0,a=b.length;c<a;c++){b[c]()}}},StoreInArray:function(c,e,j){var h=e.split(".");var b=h.length;var a=c;for(var g=0;g<b;g++){var f=h[g];if(g!=b-1){if(!IsObject(a[f])){a[f]={}}}else{if(a[f]){if(!IsArray(a[f])){a[f]=[]}a[f].push(j)}else{a[f]=j}}a=a[h[g]]}return c},FormToArray:function(a){var c={};var b=$(a);$("input",b).each(function(k,g,h){var e=$(k);var f=e.get("@name");var l=e.get("value");var j=e.get("@type");if(!f){return}switch(j){case"number":l=parseFloat(l);break;case"datetime-local":l=LocalToGMT(l);break}P.StoreInArray(c,f,l)});$("textarea",b).each(function(j,g,h){var e=$(j);var f=e.get("@name");var k=e.get("value");if(!f){return}P.StoreInArray(c,f,k)});$("select",b).each(function(j,g,h){var e=$(j);var f=e.get("@name");var k=e.get("value");if(!f){return}P.StoreInArray(c,f,k)});$(".ToggleButton",b).each(function(j,g,h){var e=$(j);var f=e.get("%name");var k=e.get("%toggled");if(f){P.StoreInArray(c,f,k)}});$(".FormInput",b).each(function(j,g,h){var e=$(j);var f=e.get("%name");var k=e.get("%value");if(f&&k){P.StoreInArray(c,f,k)}});return c},NumToPath:function(b,g){g=g||9;var f=format("{:0"+g+"}",b);var e=[];var a=f.length-2;for(var c=0;c<a;c+=3){e.push(f.substr(c,3))}return e.join("/")},DeleteParent:function(b,a){$(a).up(b).remove()},SortArray:function(h,f,g,e){var b=[];var c=null;for(var a in h){if(h[a]){if(e){c=h[a][g][e]}else{if(g){c=h[a][g]}else{c=h[a]}}if(c==undefined){continue}if(c&&f){c=c.toString().toLowerCase()}b.push([a,c])}}b.sort(function(k,j){if(k[1]==j[1]){return 0}return(k[1]>j[1])?1:-1});return b},MakeToggleNext:function(a){$(a).each(function(f,c){var b=$(f);var e=b.next();e.hide();b.set("+HoverHighlight");b.add(HTML(P.Icon("Arrow","h","FlipV ToggleIcon",2.5)));e.add(HTML('<a class="Button MiniButton Color4" onclick="P.ToggleThis(this)">'+T[37]+P.Icon("Arrow","h","ToggleIcon",2.5)+"</a>"))});P.OnClick(a,LBUTTON,P.ToggleNext)},ToggleNext:function(h,f){var a=$(f);var c=a.next();var g=$(".ToggleIcon",a);var b=g.is(".FlipV");if(b){c.hide();g.set("-FlipV")}else{c.show();g.set("+FlipV")}},ToggleThis:function(c){var a=$(c).up();var b=$(a.trav("previousSibling")[0]);a.hide();$(".ToggleIcon",b).set("@src",P.baseurl+"i/h/icons/down.png")},SortChildrenByText:function(a,b,c){c=c||"";var f=$(a);var e=f.children(b).get();e.sort(function(h,g){var k=$(h).find(c).text().toLowerCase();var j=$(g).find(c).text().toLowerCase();return(k<j)?-1:(k>j)?1:0});f.empty().append(e)},MakeToggleButtons:function(a,b){$(a).each(function(f,e){var c=$(f);switch(c.get("%toggled")){case"on":c.set("-dredg -lgrayg +lgreeng");break;case"off":c.set("+dredg -lgrayg -lgreeng");break;case"unset":c.set("-dredg +lgrayg -lgreeng")}});P.OnClick(a,LBUTTON,function(g){var c=P.Target(g);switch(c.get("%toggled")){case"on":if(b){c.set("%toggled","off").set("+dredg -lgrayg -lgreeng")}else{c.set("%toggled","unset").set("-dredg +lgrayg -lgreeng")}break;case"off":c.set("%toggled","unset").set("-dredg +lgrayg -lgreeng");break;default:c.set("%toggled","on").set("-dredg -lgrayg +lgreeng")}var f=c.get("%ontoggle");if(f){window[f](g,c)}})},ToggledButtons:function(a){var b={on:[],off:[],unset:[]};$(a).each(function(g,e,f){var c=$(g);var h=c.get("%value");b[c.get("%toggled")].push(c.text())});return b},MakeRadioButtons:function(e,j,f){var b=$(e);var h=[];var c=j.length;if(c>8){h.push("<select>")}for(var g=0,c=j.length;g<c;g++){var k=j[g];if(c>8){h.push('<option value="'+EncodeEntities(k[1])+'">'+k[0]+"</option>")}else{h.addtext(['<div class="RadioButton HoverHighlight Button'+g+(k[3]?" "+k[3]:"")+(k[2]?" lgreeng":" lgrayg")+'" data-value="'+EncodeEntities(k[1])+'" data-state="'+(k[2]?"on":"unset")+'">','<img class=LineHeight src="'+P.ImageURL("icons/radio.png","h")+'" />',k[0],"</div>"])}}if(c>8){h.push("</select>")}else{b.set("+RadioGroup")}b.ht(h.join("\n"));if(c<=8){var a=$(e+" .RadioButton");$(a[0]).set("$borderRadius","1em 0em 0em 1em");$(a[a.length-1]).set("$borderRadius","0em 1em 1em 0em");P.OnClick(e+" .RadioButton",LBUTTON,function(o){var l=P.Target(o);if(!l.is(".RadioButton")){l=l.up(".RadioButton")}var n=l.get("%value");var m=l.up();m.select("div",true).each(function(p){var q=$(p);if(q.get("%value")==n){q.set("-lgrayg +lgreeng").set("%state","on")}else{q.set("-lgreeng +lgrayg").set("%state","unset")}});if(f){f(n)}})}else{if(f){$(e+" select").on("change",function(l){f(P.Selected(P.Target(l)).value)})}}},Set:function(a){P.API("h/sessions/set",{values:a})},API:function(f,c,a,b){var e={method:"post",timeout:10,handleerror:1};b=Merge(e,b);P.AJAX("/a/"+f,JSON.stringify(c),b).then(function(g){var h=0;try{var h=$.parseJSON(g.response)}catch(j){}if(!h){throw new Error("P.API: No JSON returned! "+g.statusText+": "+g.response)}else{if(h.error&&b.handleerror){throw new Error("P.API: "+h.error)}else{if(a){a(h)}}}},function(g){throw new Error("P.API: "+g.statusText+": "+g.response)})},LoadingAPI:function(b,g,e,c,a){var f={handleerror:0};a=Merge(f,a);b=$(b);P.Loading(b);this.API(g,e,function(h){if(h.error){b.ht("<div class=Error>"+h.error+"</div>")}else{c(h,b)}},a)},LoadingDialog:function(){return P.Popup(HTML(['<div class="LoadingResults Padded FullWidth Centered">','<img src="/i/h/loading.gif" style="width: 96%"></div>'].join("\n")))},DialogAPI:function(g,e,c,a){var f={handleerror:0};a=Merge(f,a);var b=P.LoadingDialog();this.API(g,e,function(h){if(h.error){$(".LoadingResults").ht(['<div class="whiteb Rounded Pad50">',"<div class=Error>"+h.error+"</div>","<br>",'<div><a class="Button Color1 Width93" onclick="P.CloseThisPopup(this)">'+T[37]+"</a></div>","</div>"].join("\n"))}else{P.ClosePopup(b);c(h)}},a)},ChangeWallpaper:function(a,b){var c=a.split("-");this.wallpaper=c[0];this.texttheme=c[1].replace(".jpg","");this.OnResize();if(!b){this.API("wallpapers/set",{filename:c[0]},function(){})}},SetLanguage:function(a){this.API("translations/setlang",{langcode:a},function(){window.location.reload(1)})},AJAX:function(a,e,b){var g={method:"get",timeout:15};b=Merge(g,b||{});if(b.method=="get"&&e){a+="?"+ToParams(e)}var f=_.promise();var c=new XMLHttpRequest();c.open(b.method,a);c.timeout=b.timeout*1000;c.addEventListener("load",function(){f.fire(true,[c,"loaded"])});c.addEventListener("error",function(){f.fire(false,[c,"error"])});c.addEventListener("abort",function(){f.fire(false,[c,"aborted"])});c.addEventListener("timeout",function(){f.fire(false,[c,"timeout"])});if(b.method=="post"&&e){c.send(e)}else{c.send()}return f},EvalInlineScripts:function(contentdiv){$("script",contentdiv).each(function(item,index,context){var src=$(item).get("@src");if(!src){eval($(this).text())}})},LoadURL:function(c,a,b){b=b||{};title=b.title||"";content=b.content||"";contentfunc=b.contentfunc||"";data=b.data||{};contentdiv=b.contentdiv||"#Content";if(c==P.currenturl){return}P.currenturl=c;if(!a||!P.useadvanced){P.LoadingDialog();window.location=c}else{if(content||contentfunc){history.pushState({title:title,content:content,contentdiv:contentdiv,contentfunc:contentfunc,data:data},title,c);if(contentfunc){window[contentfunc](data);P.dontrestorecontent.push(1)}}else{contentdiv=$(contentdiv);P.Loading(contentdiv);P.AJAX(c,{contentonly:true},{timeout:10000}).then(function(e){d=$.parseJSON(e.response);if(!d){contentdiv.ht("<div class=Error>Problem getting content... Please try again</div>")}else{if(d.error){contentdiv.ht("<div class=Error>"+d.error+"</div>")}else{contentdiv[0].innerHTML=d.content;$("script",contentdiv).each(function(h,f,g){var j=$(h).get("@src");if(j){_loader.Load(j)}});_loader.OnFinished(function(){P.EvalInlineScripts(contentdiv)});history.pushState(d,d.title,c);window.scrollTo(0,0)}}}).error(function(e,f){contentdiv.ht("<div class=Error>"+e.reason+"<br>"+e.responseText+"</div>")})}}},CloseTopLayer:function(){if(P.layerstack.length){for(;;){if(!P.layerstack.length){break}var a=P.layerstack.pop();var b=$(a);if(!b.length){break}if(a.indexOf("Popup")>-1){$(a).remove()}else{$(a).ht("").hide()}window.history.back();return 1}}return 0},OnPopState:function(e){if(P.CloseTopLayer()){return}if(e.state){if(e.state.contentfunc){window[e.state.contentfunc](e.state.data)}else{if(!P.dontrestorecontent.pop()){var contentdiv=$(e.state.contentdiv);contentdiv.ht(e.state.content);$("script",contentdiv).each(function(){eval($(this).text())})}}}else{if(!P.dontrestorecontent.pop()){window.location.reload(1)}}},PageBar:function(k,a,f,l,m,n){k=parseInt(k);a=parseInt(a);m=parseInt(m);n=n||"ListObjects";f=parseInt(f)||100;numpages=Math.ceil(k/f);var h=["<div class=Cleared></div>","<div class=Pad50>",(k?(a+1):0)+" - "+(a+m)+" / ~"+k,"</div>",'<div class="ButtonBar PageBar">'];if(k>f){if(a){h.push('<a class="FirstPage" onclick="'+n+"('"+l+"', 0)\">&lt;&lt;</a>");if(a>=f){h.push('<a class="PreviousPage" onclick="'+n+"('"+l+"', "+(a-f)+')">&lt;</a>')}}var b=Math.floor(a/f);var c=0;var j=numpages;if(numpages>16){c=b>8?b-8:0;j=b+8<numpages?b+8:numpages}for(var g=c;g<j;g++){var e=g*f;if(e!=a){h.push('<a onclick="'+n+"('"+l+"', "+e+')">'+e+"</a>")}}if(a+f<k){if(a+f<k-f){h.push('<a class="NextPage" onclick="'+n+"('"+l+"', "+(a+f)+')">&gt;</a>')}h.push('<a class="LastPage" onclick="'+n+"('"+l+"', "+(Math.ceil((k-f)/f)*f)+')">&gt;&gt;</a>')}}if(numpages>16){h.push("<a class=ChoosePage onclick=\"P.ChoosePage('"+l+"', "+a+", "+f+", "+k+", '"+n+"')\">"+T[34]+"</a>")}h.push("</div>");h.push("<div class=Cleared></div>");return h},ChoosePage:function(e,h,a,b,g){var f=Math.floor(h/a)+1;var c=Math.ceil(b/a);P.EditPopup([["pagenum","int",f,T[35]+" (1-"+c+")","","min=1 max="+c]],function(){P.GotoPage(e,a,g)});P.OnEnter(".pagenum",function(){P.GotoPage(e,a,g)});setTimeout(function(){var j=$$(".pagenum");j.focus();j.select()},500)},GotoPage:function(b,a,c){var e=a*(parseInt($$(".pagenum").value)-1);P.ClosePopup();window[c](b,e,a)},OnPauseButton:function(a){var b=P.media[a];if(b){if(b.playing()){$(".PlayBar .PauseButton").set("@src",P.ImageURL("icons/pause.png","h"));b.pause()}else{$(".PlayBar .PauseButton").set("@src",P.ImageURL("icons/play.png","h"));b.play(P.currentmediaid)}}},OnPlayTimer:function(a){if(P.media[a]&&P.media[a].playing()){var b=P.media[a].seek();$(".PlayBar .CurrentPos").fill(SecondsToTime(b,1));$(".PlayBar .Position").set("value",b);setTimeout(function(){P.OnPlayTimer(a)},300)}},MakePlayButtons:function(a){$(a).each(function(c,b){$(c).set("+HoverHighlight").ht('<img class=DoubleLineHeight src="'+P.ImageURL("icons/play.png","h")+'"/>')});P.OnClick(a,LBUTTON,function(g){var f=P.Target(g);var c=f.get("%url");var b=$("img",f,1);var h=b.get("@src");b.set("@src",P.ImageURL("busy.svg","h"));P.Popup(HTML(['<div class="whiteb Pad50 Raised Rounded PlayBar">','<img src="'+P.ImageURL("loading.gif","h")+'"/>',"</div>"].join("\n")),{closeonmouseout:1,parent:f});P.Play(c,c,{autoplay:1,onplay:function(){var e=P.media[c];var j=e.duration();P.HTML(".PlayBar",['<img class="DoubleLineHeight PauseButton HoverHighlight" src="'+P.ImageURL("icons/play.png","h")+'"/>',"<span class=CurrentPos>"+SecondsToTime(0,1)+"</span> / <span class=Duration>"+SecondsToTime(j,1)+"</span>",'<meter class="Position Width100" min=0 max='+j.toFixed(0)+"></meter>"]);P.OnClick(".PlayBar .PauseButton",LBUTTON,function(){P.OnPauseButton(c)});P.OnClick(".PlayBar .Position",LBUTTON,function(q){var n=P.Target(q);var o=parseInt(n.get("@min"));var k=parseInt(n.get("@max"));var p=n[0].value;var l=P.AbsoluteRect(n);var m=Math.round(((P.mousex-l.left)/l.width)*(k-o))+o;if(p==m){return}n[0].value=m;if(P.media[c]){P.media[c].seek(m)}});b.set("@src",h);setTimeout(function(){P.OnPlayTimer(c)},300)},onloaderror:function(j,e){$(".PlayBar").ht("<div class=Error>"+e+"</div>");b.set("@src",h)}})})},Play:function(e,b,a){a=a||{};a.src=[b];if(!P.media[e]){P.mediatoload.push(b);var c=a.onload;a.onload=function(){P.mediatoload.remove(b);if(!P.mediatoload.length){for(var g=0,f=P.onmedialoaded.length;g<f;g++){P.onmedialoaded[g]()}P.onmedialoaded=[]}if(c){c()}};P.media[e]=new Howl(a)}else{if(a.autoplay!=0){P.currentmediaid=P.media[e].play()}}},OnMediaLoaded:function(a){P.onmedialoaded.push(a)},AddLayer:function(a){P.layerstack.push(a)},RemoveLayer:function(a){var b=P.layerstack.indexOf(a);if(b>-1){P.layerstack.remove(b)}},EnterFullScreen:function(a,c,b){a=parseInt(a);a=a||"";P.AddLayer(".FullScreen"+a);var e=$(".FullScreen"+a);if(c){e.set(c)}e.ht(b.join("\n")).set("$left","-"+window.outerWidth+"px").show().animate({$left:"0px"},300)},ExitFullScreen:function(b){b=parseInt(b);b=b||"";var a="FullScreen"+b;P.RemoveLayer("."+a);var c=$("."+a);c.animate({"$left":"-"+window.outerWidth+"px"},300);setTimeout(function(){c.set("@class",a).ht("").hide()},500)},ShowDrawer:function(f,e,c,b){var g=$("."+f+"Drawer");if(c){g.set(c)}var h=(f=="left"||f=="right")?"$width":"$height";var a={};a[h]=e;g.ht(b.join("\n")).set(h,"0px").show().animate(a,300)},HideDrawer:function(b){var c=$("."+b+"Drawer");c.set("@class","Drawer "+b+"Drawer");var e=(b=="left"||b=="right")?"$width":"$height";var a={};a[e]="0px";c.animate(a,300)},ReloadPage:function(){window.location.reload(1)},NoPaste:function(a){$(a).on("copy paste drag drop",function(b){b.preventDefault()})},CaptureMousePos:function(a){P.mousex=a.changedTouches?a.changedTouches[0].pageX:a.pageX;P.mousey=a.changedTouches?a.changedTouches[0].pageY:a.pageY;P.istouch=(a.type.indexOf("touch")!=-1)},MousePos:function(){return[P.mousex,P.mousey]},InRect:function(a,c,b){if(!b){return 0}return(b.left<=a&&a<=b.right&&b.top<=c&&c<=b.bottom)},FlexInput:function(){$(".FlexInput").each(function(g,c){var a=$(g);var b=a.get("%name");var h=a.get("%value");if(!b){a.ht("<div class=Error>No name provided</div>");return}P.HTML(a,["<pre><span></span><br></pre>",'<textarea class="'+b+'" name="'+b+'"></textarea>']);var f=$("textarea",a);var e=$("span",a);f.on("input",function(){e.fill(f.get("value"))});f.fill(h);e.fill(h);a.set("+active")})},SetCookie:function(c,g,b,j,f,h){j=j||"/";var a=new Date();if(b){b=expires*1000*60*60*24}var e=new Date(a.getTime()+b);document.cookie=c+"="+escape(g)+(b?";expires="+e.toGMTString():"")+";path="+j+(f?";domain="+f:"")+(h?";secure":"")},Emit:function(b,c){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent(c,true,true);return !b.dispatchEvent(a)}else{var a=document.createEventObject();return b.fireEvent("on"+c,a)}},MakeCalendar:function(m,t,a,k){var r=t?new Date(t):new Date();if(isNaN(r.getTime())){$(m).ht("<div class=Error>Invalid date: "+t+"</div>");return}var e=r.getDate();var b=r.getDay();var n=r.getFullYear();var j=r.getMonth();var s=j==11?0:j+1;var o=(j==11)?(n+1)+"-01":n+"-"+(j<8?"0"+(j+2):(j+2));var l=(j==0)?(n-1)+"-12":n+"-"+(j<10?"0"+j:j);var g=['<table class="Styled Calendar Width100 Center">',"<tr>",a?'<td class="Color1 PreviousMonthButton">&lt;&lt;</td>':"<th></th>","<td colspan=5 class=ThisMonth>"+n+"-"+(j<9?"0"+(j+1):(j+1))+"</td>",a?'<td class="Color2 NextMonthButton">&gt;&gt;</td>':"<th></th>","</tr>","<tr>","<th>"+T_CALENDAR[9]+"</th>","<th>"+T_CALENDAR[10]+"</th>","<th>"+T_CALENDAR[11]+"</th>","<th>"+T_CALENDAR[12]+"</th>","<th>"+T_CALENDAR[13]+"</th>","<th>"+T_CALENDAR[14]+"</th>","<th>"+T_CALENDAR[15]+"</th>","</tr>"];r.setDate(1);r.setDate(r.getDate()-r.getDay()+1);var p=0;var c=new Date();var v=c.getMonth();var u=c.getDate();for(;;){g.push("<tr>");for(var p=0;p<7;p++){var h=r.getDate();var q=r.getMonth();var f=(h<10?"0"+h:h);g.addtext(['<td class="'+((q==v&&h==u)?"Today ":"")+(q==j?"Day Day"+f+'" data-date="'+f:"OtherMonth")+'">'+h+"</td>"]);r.setDate(h+1)}g.push("</tr>");if(r.getMonth()==s||p>60){break}p++}g.push("</table>");P.HTML(m,g);if(a){P.OnClick(m+" .NextMonthButton",LBUTTON,function(){a(m,o)});P.OnClick(m+" .PreviousMonthButton",LBUTTON,function(){a(m,l)})}if(k){P.OnClick(m+" .Calendar",LBUTTON,k)}},OnEnter:function(a,b){$(a).on("?keypress",function(c){if(c.keyCode==13){b();return false}return true})},MiniLogin:function(){P.DialogAPI("login/login",{phonenumber:$(".MiniLogin input.phonenumber").sub(1).get("value"),place:$(".MiniLogin input.place").sub(1).get("value"),password:$(".MiniLogin input.password").sub(1).get("value")},function(a){window.location=document.location})},PopupMiniLogin:function(){$(".MiniLogin .phonenumber")[1].focus();P.OnEnter(".MiniLogin",P.MiniLogin);P.OnClick(".MiniLoginButton",LBUTTON,P.MiniLogin)},PreloadImage:function(e){if(IsArray(e)){for(var f=0,a=e.length;f<a;f++){P.Preload(e[f])}return}for(var c in P.preloads){if(c==e){return P.preloads[c]}}var b=new Image();b.src=e;P.preloads[e]=b;return b},SlideShow:function(a,g,c){var b={nextimage:"random",timeout:4000,imgfraction:0.7};Merge(b,c);var f=$(a);var h=f[0];h.slides=g;h.slidepos=0;h.imgfraction=b.imgfraction;h.nextimage=b.nextimage;h.timeout=b.timeout;h.selector=a;f.set("+SlideShow");P.NextSlide(h)},NextSlide:function(a){var b=P.ViewPortRect().width;$(a.selector+" .Slide").set("$transform","translate(-"+(b*1.2)+"px, 0)");setTimeout(function(){var c=-1;if(a.nextimage=="random"){do{c=RandInt(0,a.slides.length)}while(c==a.slidepos)}else{c=a.slidepos+1;if(c>=a.urls.length){c=0}}a.slidepos=c;a.innerHTML='<div class=Slide style="position: relative; left: '+(b*0.5)+'px;">'+a.slides[a.slidepos]+"</div>";$(a.selector+" img").set("$height",$$(".SlideShow").getBoundingClientRect().height*a.imgfraction+"px");$(a.selector+" img").set("$width","auto");$(a.selector+" .Slide").set("$transform","translate(-"+(b*0.5)+"px, 0)");setTimeout(function(){P.NextSlide(a)},a.timeout)},1000)},MakeTabs:function(a,f){a=$(a);a.set("+TabBar");var c=[];for(var e=0,b=f.length;e<b;e++){var h=f[e];var g=window.location.href.match(h[1])?"class=Selected":"";c.push('<a data-regex="'+EncodeEntities(h[1])+'" href="'+EncodeEntities(h[2])+'" '+g+">"+h[0]+"</a>")}c.push("<div class=Cleared></div>");P.HTML(a,c)},MakeEditTags:function(b,a,f){var g=$(b);g.set("+EditTags");var e=g[0];e.origtaglist=a.slice();var c=["<p class=EditTagsList>","</p>","<div class=ButtonBar>",'<a class="Color1 AddTagButton">+</a>','<a class="Color2 ResetTagsButton">'+T[39]+"</a>",'<a class="Color3 SaveTagsButton">'+T[25]+"</a>","</div>","<div class=SaveTagsResults></div>"];P.HTML(g,c);P.MakeEditTagsContent(b,a);P.OnClick(".EditTags .Tag",LBUTTON,function(){$(this).remove()});$(".AddTagButton").on("click",function(){var h=$(this);P.EditPopup([["newtag","text",T[54]]],function(){var j=$(".newtag").get("value");if(!a.contains(j)){a.push(j);P.MakeEditTagsContent(b,a)}return true},{parent:h})});$(".ResetTagsButton").on("click",function(){P.MakeEditTagsContent(b,e.origtaglist)});P.OnClick(".SaveTagButton",LBUTTON,function(){onsavefunc(b)})},MakeEditTagsContent:function(b,a){a.sort();var e=[];for(var f=0,c=a.length;f<c;f++){e.push('<a class=Tag><img src="/i/h/svg/tag.svg">'+a[f]+"</a>")}P.HTML(b+" .EditTagsList",e)},InterceptHREF:function(){$("body").on("?click",function(c){var b=P.Target(c);if(b[0].tagName!="A"){b=b.up("a")}if(!b.length){return 1}var a=b.get("@href");if(P.baseurl!="/"&&!a.indexOf(P.baseurl)){P.LoadingDialog();return 1}if(!b.get("%nointercept")&&a&&a.indexOf("http")!=-1){P.LoadURL(a,1);c.preventDefault();c.stopPropagation();return 0}return 1})},ListObjects:function(a){start=a.start||0;limit=a.limit||100;data=Merge({start:start,limit:limit,orderby:a.orderby},a.data);P.LoadingAPI(a.selector,a.api,data,function(h,g){var e=h.items;if(!e.length){g.ht("No items found");return}var c=[];for(var f=0,b=e.length;f<b;f++){c.addtext(a.itemfunc(f,e[f]))}c.addtext(P.PageBar(h.count,start,limit,a.orderby,e.length,a.listfunc));P.HTML(g,c);P.AutoWidth()})},RotateImage:function(a,b){},RotateImage:function(a,c){var b=$(a);var e=parseInt(b.get("%angle"));if(!e){e=0}e+=c;if(e<0){e+=360}if(e>=360){e-=360}b.set({"%angle":e,"$transform":"rotate("+e+"deg)"})},Emit:function(h,c,f){f=Merge({pointerX:0,pointerY:0,button:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,bubbles:true,cancelable:true},f||{});var b,g=null;for(var e in {HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/}){if(eventMatchers[e].test(c)){g=e;break}}if(!g){throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported")}if(document.createEvent){b=document.createEvent(g);if(g=="HTMLEvents"){b.initEvent(c,f.bubbles,f.cancelable)}else{b.initMouseEvent(c,f.bubbles,f.cancelable,document.defaultView,f.button,f.pointerX,f.pointerY,f.pointerX,f.pointerY,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.button,h)}h.dispatchEvent(b)}else{f.clientX=f.pointerX;f.clientY=f.pointerY;var a=document.createEventObject();b=extend(a,f);h.fireEvent("on"+c,b)}return h},ChangeWallpaperPopup:function(){var b=['<div class="Wallpapers">'];for(var c=0,a=availablewallpapers.length;c<a;c++){var e=availablewallpapers[c];b.push('<img class=HoverHighlight src="'+P.ImageURL("wallpapers/"+e,"h")+'" onclick="P.ChangeWallpaper(\''+e+"')\">")}b.push("</div>");P.Popup(HTML(b.join("\n")),{closeonmouseout:1,parent:".WallpapersMenu","$width":"10em"})},ChangeLanguagePopup:function(){var b=['<div class="Languages">'];var c=1;for(var e=0,a=availablelanguages.length;e<a;e++){var f=availablelanguages[e];b.push('<a class="Button Color'+c+'" onclick="P.SetLanguage(\''+f[0]+"')\">"+f[1]+"</a>");c++;if(c>6){c=1}}b.push("</div>");P.Popup(HTML(b.join("\n")),{closeonmouseout:1,parent:".LanguagesMenu","$width":"10em"})},UserMenuPopup:function(){var a=["<div>"];var b=1;if(P.userid){a.push('<a class="Button Color1" href="/logout">'+T[27]+"</a>")}else{P.EditPopup([["phonenumber","text","",T[42]],["place","text","",T[43]],["password","password","",T[17]]],P.MiniLogin,{parent:".UserMenu",closeonmouseout:1,gobuttontext:T[47],cancelbuttontext:T[1],cancelfunc:function(){P.CloseThisPopup(".password")}});P.OnEnter(".EditPopupForm input",function(){P.MiniLogin($(".EditPopup"),P.FormToArray(".EditPopupForm"))});setTimeout(function(){var c=$$(".EditPopup .phonenumber");if(c){c.focus()}},200);return}a.push("</div>");P.Popup(HTML(a.join("\n")),{closeonmouseout:1,parent:".UserMenu","$width":"10em"})},MiniLogin:function(b,a){if(!a.phonenumber||!a.place||!a.password){P.ErrorPopup("<?=$T_SYSTEM[48]?>");return}P.LoadingAPI(".EditPopupResults","login/login",a,function(e,c){window.location.reload(1)})},AdminMenuPopup:function(){var b=["<div>"];var e=1;adminpages.sort();for(var f=0,a=adminpages.length;f<a;f++){var g=adminpages[f];if(g.indexOf("/")>-1){var c=P.baseurl+"m/"+g}else{var c=P.baseurl+"m/h/"+g}b.push('<a class="Button Color'+e+'" href="'+c+'">'+g+"</a>");e++;if(e>6){e=1}}b.push("</div>");P.Popup(HTML(b.join("\n")),{closeonmouseout:1,parent:".AdminMenu","$width":"10em"})},HoverPopup:function(a,b){$(a).set("+HoverHighlight");P.OnClick(a,LBUTTON,b)},UploadFilePopup:function(b,a){a=a||{};a.accept=a.accept||"image/*; capture=camera";a.maxsize=a.maxsize||4294967296;a.filetype=a.filetype||"";a.title=a.title||0;a.onfinished=a.onfinished||0;a.resizeimage=a.resizeimage||0;P.MessageBox(['<form class="UploadFileForm" method="post" enctype="multipart/form-data">','<input type=file class=FilesToUpload accept="'+a.accept+'" data-maxsize="'+a.maxsize+'" data-filetype="'+a.filetype+'" data-uploadurl="'+EncodeEntities(b)+'" multiple style="cursor: pointer;"><br><br>',(a.title?("<label>"+EncodeEntities(a.title)+"</label><input type=text class=uploadtitle>"):""),"<div class=UploadedFiles></div>","</form>","<br>"],[[T[47],function(){P.UploadFile(0,a)},3],[T[1],function(){P.CloseThisPopup(".UploadFileForm")},1]]);$$(".FilesToUpload").click();if(!a.title){$(".FilesToUpload").on("change",function(){P.UploadFile(0,a)})}},MakeProgressHandler:function(a){return function(c){var b=$(".UploadedFiles .Upload"+a+" .Right");P.UploadFileProgress(c,b)}},UploadProgress:function(b,a){return function(f){var c=$(".UploadedFiles .Upload"+i+" .Right");P.UploadFileProgress(f,c)}},UploadFile:function(c,r){c=c||".FilesToUpload";var g=$(c);var e=$$(g).files;var j=e.length;var a=$(".uploadtitle");var q=a.length?$$(a).value:0;if(!j){P.ErrorPopup(T[65]);return}if(a.length&&!q){P.ErrorPopup(T[48]);return}var p=g.get("%uploadurl");var o=g.get("%filetype");var n=g.get("%maxsize");for(var m=0;m<j;m++){var h=e[m];if(o&&!h.type.match(o)){P.ErrorPopup(h.name+" is the wrong type");continue}$(".UploadedFiles").add(HTML(['<table class="Width100 Upload'+m+'">',"<tr><td>"+EncodeEntities(h.name)+"</td><td class=Right>0%</td></tr>","</table>"].join("\n")));var b=p+"/"+(q?encodeURIComponent(q)+"/":"")+encodeURIComponent(h.name);if(r.resizeimage&&h.type.match(/image.*/)){var k=document.createElement("img");k.src=window.URL.createObjectURL(h);var f=document.createElement("canvas");f.width=r.resizeimage[0];f.height=r.resizeimage[1];pica.resizeCanvas(k,f,{unsharpAmount:50,unsharpRadius:1,unsharpThreshold:70},function(l){P.SendFile(m,b,h,r)})}else{P.SendFile(m,b,h,r)}}},SendFile:function(e,b,c,a){var f=new XMLHttpRequest();f.open("post",b,true);f.upload.addEventListener("progress",P.MakeProgressHandler(e,c.name));if(a&&a.onfinished){f.onload=function(g){a.onfinished(g,f,c.name)}}f.send(c)},UploadFileProgress:function(c,a){var b=Math.round(c.loaded/c.total*100);a.fill(b+"%")},DeleteUpload:function(b,a){P.DialogAPI("upload/delete/"+b,{},function(c){if(a){a(c,b)}})},Location:function(a){if(P.inphoneapp){a(JSON.parse(JSBridge.Location()))}else{navigator.geolocation.getCurrentPosition(function(b){a(b.coords)},function(){P.ErrorPopup(T[66])},{enableHighAccuracy:true,maximumAge:30000,timeout:20000})}},MakeOnClick:function(a,b){return function(c){var f=P.Target(c);if(!f.is(a)){f=f.up(a)}if(!f){return}if($(a+" .Selected").length){if(f.is(".Selected")){f.set("-Selected");if(!$(a+" .Selected").length){$(".BottomDrawer").hide()}}else{f.set("+Selected")}return}if(b){b(c,f)}}},MakeOnHold:function(a,c,b){return function(m){if(m.button==1||m.button==2){return}var f=P.Target(m);if(!f.is(a)){f=f.up(a)}if(!f){return}var k=$(".Selected").length;var g=f.get(c);var p=$(a);var o=0;for(var j=0,h=p.length;j<h;j++){var n=$(p[j]);if(n.get(c)==g){break}if(o){n.set("+Selected")}else{if(n.is(".Selected")){o=1}}}o=0;for(var j=p.length-1;j>=0;j--){var n=$(p[j]);if(n.get(c)==g){break}if(o){n.set("+Selected")}else{if(n.is(".Selected")){o=1}}}f.set("+Selected");$(".BottomDrawer").set({"$width":"100%","$height":"2.3em"}).set("+lgrayg").show();if(b){b(m,f)}}},MakeContextMenu:function(a,b){b=b||{};b.width=b.width||"12em";return function(k){var h=P.Target(k);if(b.topclass&&!h.is(b.topclass)){h=h.up(b.topclass)}if(!h.length){return}P.CancelBubble(k);var f=['<div class="Raised">',"<div class=ContextMenu>"];var m=IsFunc(a)?a(h):a;for(var g=0,c=m.length;g<c;g++){var j=m[g];f.push("<a class=ContextMenuItem data-pos="+g+">"+j[0]+"</a>")}f.push("</div></div>");P.Popup(HTML(f.join("\n")),{"$left":P.mousex+"px","$top":P.mousey+"px","$width":b.width,closeonmouseout:1});P.contextmenuitems=m;P.OnClick(".ContextMenu",LBUTTON,function(o){var n=P.Target(o);if(!n.is(".ContextMenuItem")){n=n.up(".ContextMenuItem")}if(!n.length){return}P.CloseThisPopup(".ContextMenu");var l=P.contextmenuitems[parseInt(n.get("%pos"))][1];l(o,h)})}},OnAltEnter:function(a,b){$(a).on("?keydown",function(f){if(f.defaultPrevented){return}var c=false;if(f.key!==undefined){if(f.key==="Enter"&&f.altKey){b(a,f)}}else{if(f.keyIdentifier!==undefined){if(f.keyIdentifier==="Enter"&&f.altKey){alert("Alt + Enter pressed!")}}else{if(f.keyCode!==undefined){if(f.keyCode===13&&f.altKey){alert("Alt + Enter pressed!")}}}}if(c){f.preventDefault();return 0}return 1})},MakeQuickFuncsButton:function(a,b){a=a||".QuickFuncsButton";b=b||P.possumbot;P.MakeFloatingButton(a,'<div class="redb HoverHighlight Pad50 Rounded Raised"><img class=DoubleLineHeight src="/i/h/avatars/'+b+'.png" /></div>');P.OnClick(a,LBUTTON,P.ShowQuickFuncsPopup)},ShowQuickFuncsPopup:function(c,f){f=f||"";var b=P.Popup(HTML(['<div class="whiteb Pad50 Raised">','<div class="FlexInput QuickFuncInput" data-name="quickfuncinput" data-value="'+EncodeEntities(f)+'"></div>',"<div class=QuickFuncsButtons></div>","<div class=QuickFuncResults></div>","</div>"].join("\n")),{"$width":(window.innerWidth*0.8)+"px"});P.FlexInput();P.MakeButtonBar(".QuickFuncsButtons",[[T[47],P.ProcessQuickFunc],[T[71],P.QuickFuncsHelp],[T[1],function(){P.CloseThisPopup(".QuickFuncInput")}]]);var a=$(b+" textarea");P.OnAltEnter(a,P.ProcessQuickFunc);$$(a).focus()},AddQuickFunc:function(e,a,c,b){P.quickfuncs.push([e,a,c,b]);P.quickfuncs.sort(function(h,g){var f=h[0].length;var j=g[0].length;if(f>j){return -1}if(f<j){return 1}return 0})},ProcessQuickFunc:function(){var g=$(".QuickFuncInput textarea").get("value");if(g){var b=g.toLowerCase();var e=0;for(var c=0,a=P.quickfuncs.length;c<a;c++){var f=P.quickfuncs[c][0];if(b.startswith(f.toLowerCase())){P.quickfuncs[c][3](g.substr(f.length).trim(),$(".QuickFuncResults"));e=1;break}}if(!e){$(".QuickFuncResults").ht('<div class="yellowb Pad50">'+T[72]+"</div>")}}},QuickFuncsHelp:function(){var f=['<div class="Pad50 whiteb">',"<div class=Left>","<h2>"+T_POSSUMBOT[1]+"</h2>","<p>"+T_POSSUMBOT[2]+"</p>","<h3>"+T_POSSUMBOT[3]+"</h3>","<dl>"];for(var c=0,a=P.quickfuncs.length;c<a;c++){var e=P.quickfuncs[c];var b=(c%6)+1;f.addtext(["<dt>",'<a class="Button Color'+b+'" onclick="P.CopyQuickFuncCommand(\''+EncodeEntities(e[0])+"')\">",e[1],"</a>","</dt>","<dd><p>"+e[2]+"</p></dd>"])}f.addtext(["</dl>","<p>"+T_POSSUMBOT[9]+"</p>","<div class=ButtonBar>",'<a class=Color1 onclick="P.ExitFullScreen(1)">'+T[1]+"</a>","</div>","</div>","</div>"]);P.CloseThisPopup(".QuickFuncInput");P.EnterFullScreen(1,"",f)},CopyQuickFuncCommand:function(a){P.ExitFullScreen(1);P.ShowQuickFuncsPopup(0,a)},QuickChangePassword:function(b,a){if(!b){a.ht('<div class="yellowb Pad50">'+T[4]+"</div>");return}P.LoadingAPI(a,"login/changepassword",{password:b},function(e,c){c.ht('<div class="greenb Pad50">'+T[41]+"</div>");setTimeout(function(){P.CloseThisPopup(".QuickFuncInput")},2000)})},QuickChangeAvatar:function(b,a){if(b.length){P.LoadingAPI(a,"possumbot/set",{avatar:b},function(e,c){$(".QuickFuncsButton img").set("@src",P.ImageURL("avatars/"+b+".png","h"));c.ht('<div class="greenb Pad50">'+T[41]+"</div>")})}else{P.LoadingAPI(a,"possumbot/list",{},function(j,g){var h=j.items;var e=["<div class=Cards4>"];for(var f=0,c=h.length;f<c;f++){e.addtext(['<div class="lgrayb Card HoverHighlight" onclick="P.QuickChangeAvatar(\''+h[f]+"')\">",'<img class=CardIcon src="'+P.ImageURL("avatars/"+h[f]+".png","h")+'">',"<div class=Center>"+h[f]+"</div>","</div>"])}e.push("</div><div class=Cleared></div>");P.HTML(g,e)})}}};P.Init();$.ready(function(){P.emsize=P.EMSize();window.onerror=function(g,f,b,e,c){StackTrace.fromError(c).then(function(h){var j=h.map(function(k){return k.toString()}).join("\n");console.log(j);P.Debug(g+"\n"+j)})};P.SetCookie("timeoffset",P.timeoffset);P.ChangeWallpaper(P.wallpaper+"-"+P.texttheme+".jpg",1);for(var a=1;a<=6;a++){$(".Color"+a).set("$color","white !important")}P.HoverPopup(".WallpapersMenu",P.ChangeWallpaperPopup);P.HoverPopup(".LanguagesMenu",P.ChangeLanguagePopup);P.HoverPopup(".UserMenu",P.UserMenuPopup);P.HoverPopup(".AdminMenu",P.AdminMenuPopup);$(window).on("|resize",P.OnResize).on("|mousemove |mouseenter |touchmove",P.CaptureMousePos).on("|orientationchange",function(){switch(window.orientation){case 90:case -90:P.screenorientation="landscape";break;default:P.screenorientation="portrait"}P.OnResize()});if(P.useadvanced){if(P.isfirefox||P.ischrome||P.issafari){$(window).on("popstate",P.OnPopState)}$(window).on(P.isfirefox?"|keypress ":"|keypress |keydown ",function(b){if(b.keyCode==27){P.CloseTopLayer()}});P.InterceptHREF()}if(window.location.href.indexOf("pafera.com")==-1){$("body").set("$fontFamily","serif")}if(P.userid){P.MakeQuickFuncsButton();P.AddQuickFunc(T_POSSUMBOT[8],T_POSSUMBOT[4],T_POSSUMBOT[5],P.QuickChangePassword);P.AddQuickFunc(T_POSSUMBOT[6],T_POSSUMBOT[6],T_POSSUMBOT[7],function(){$(".QuickFuncsButton").hide();P.CloseThisPopup(".QuickFuncInput")});P.AddQuickFunc(T_POSSUMBOT[10],T_POSSUMBOT[10],T_POSSUMBOT[11],P.QuickChangeAvatar)}interact.pointerMoveTolerance(32)});